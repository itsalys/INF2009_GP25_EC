{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Clocked-In Employees</h2>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Employee ID</th>
                <th>Timestamp</th>
                <th>Clocked In</th>
            </tr>
        </thead>
        <tbody id="attendance-table">
            <!-- Data will be inserted here dynamically -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    console.log("✅ JavaScript Loaded");

    let token = localStorage.getItem("token");

    if (!token) {
        console.error("❌ No token found. Redirecting to login...");
        window.location.href = "/auth/admin/login";  
        return;
    }

    token = token.startsWith("Bearer ") ? token : `Bearer ${token}`;  // ✅ Ensure correct format
    console.log("✅ Sending Token:", token);

    function fetchAttendance() {
        fetch("/attendance/", {
            method: "GET",
            headers: {
                "Authorization": token,
                "Content-Type": "application/json"
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log("✅ Attendance Data:", data);

            if (data.error) {
                console.error("❌ Error fetching attendance:", data.error);
                return;
            }

            let tableBody = document.getElementById("attendance-table");
            tableBody.innerHTML = ""; // Clear table

            data.forEach(record => {
                let row = `<tr>
                    <td>${record.employee_id}</td>
                    <td>${record.timestamp}</td>
                    <td>${record.clocked_in ? "✅ Yes" : "❌ No"}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        })
        .catch(error => console.error("❌ Failed to fetch attendance:", error));
    }
});
</script>
    
{% endblock %}
